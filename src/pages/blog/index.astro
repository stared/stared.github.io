---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogList from '@/components/BlogList.vue';
import { normalizePost, createScoredPosts } from '@/lib/postData';
import type { RawExternalPost } from '@/lib/postData';
import {Content as BlogIntro} from '@/content/textComponents/blog.md';

const blogPosts = await getCollection('blog');
const externalArticlesEntries = await getCollection('externalArticles');
const externalPosts = externalArticlesEntries.map((entry) => entry.data) as RawExternalPost[];

// Normalize posts ONCE at the boundary - single source of truth
const allPosts = [
  ...blogPosts.map(normalizePost),
  ...externalPosts.map(normalizePost),
];

// Create scored posts with pre-computed scores at build time
const scoredPosts = createScoredPosts(allPosts);
---

<BaseLayout title="Blog" description="Read blog posts by Piotr MigdaÅ‚.">
  <BlogIntro />
  <BlogList client:load scoredPosts={scoredPosts} />
</BaseLayout>
