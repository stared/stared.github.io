---
import { getEntry } from 'astro:content';

interface Props {
  slug: string;
}

const { slug } = Astro.props;

const slugCleaned = slug.replace(/\//g, '_').replace(/_+$/, '');
const similarityData = await getEntry('similarities', slugCleaned);
const similarPosts = similarityData?.data.most_similar || [];
---

{similarPosts.length > 0 && (
  <section class="similar-posts">
    <h2>See also cosine-similar posts</h2>
    <ul>
      {similarPosts.map((post) => (
        <li>
          <code>{post.similarity.toFixed(3)}</code>
          <a href={post.path}>{post.title}</a>
        </li>
      ))}
    </ul>
  </section>
)}

<style>
  .similar-posts {
    margin-top: 2.5em;
    padding: 1.25em 1.75em;
    background-color: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #eaecef;
  }

  .similar-posts h2 {
    margin-top: 0;
    margin-bottom: 0.75em;
    font-size: 1.1em;
    color: #444;
  }

  .similar-posts ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  .similar-posts li {
    margin: 0.5em 0;
    line-height: 1.3;
  }

  .similar-posts code {
    margin-right: 0.75em;
    color: #666;
    font-size: 0.9em;
    background-color: #fff;
    padding: 0.15em 0.4em;
    border-radius: 4px;
    border: 1px solid #eaecef;
  }

  .similar-posts a {
    color: #0366d6;
    text-decoration: none;
  }

  .similar-posts a:hover {
    text-decoration: underline;
  }
</style>
